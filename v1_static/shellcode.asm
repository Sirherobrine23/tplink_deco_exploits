#addresses of qca-legacy-uboot code
.ifdef DECO_S4_V2
 uboot_base_ram = 0x87f84000
 webfailsafe_is_running = uboot_base_ram + 0x3FDDC
 run_command = uboot_base_ram + 0x107F4
.endif
.ifdef DECO_M4R_V1
 uboot_base_ram = 0x87f88000
 webfailsafe_is_running = uboot_base_ram + 0x3B76C
 run_command = uboot_base_ram + 0x107E8
.endif
.ifdef DECO_M4R_V2
 uboot_base_ram = 0x87f88000
 webfailsafe_is_running = uboot_base_ram + 0x3B85C
 run_command = uboot_base_ram + 0x107F4
.endif

#addresses inside of uploaded fw
uploaded_fw_base = 0x80060000
s_setenv_serverip = uploaded_fw_base + 0x02A0
s_setenv_ipaddr = uploaded_fw_base + 0x2D0
s_tftpboot = uploaded_fw_base + 0x0300
s_bootm = uploaded_fw_base + 0x0400

li   $t0, webfailsafe_is_running
sw   $zero, ($t0)		# webfailsafe_is_running = 0
li   $a1, 0x0
li   $a0, s_setenv_serverip
li   $t9, run_command
jalr $ra, $t9			# run_command("setenv serverip 192.168.0.2", 0)
li   $a1, 0x0
li   $a0, s_setenv_ipaddr
li   $t9, run_command
jalr $ra, $t9			# run_command("setenv ipaddr 192.168.0.1", 0)

loop:
li   $a1, 0x0
li   $a0, s_tftpboot
li   $t9, run_command
jalr $ra, $t9			# run_command("tftpboot 0x81000000 initramfs-kernel.bin", 0)
li   $a1, 0x0
li   $a0, s_bootm
li   $t9, run_command
jalr $ra, $t9			# run_command("bootm 0x81000000", 0)
b    loop
